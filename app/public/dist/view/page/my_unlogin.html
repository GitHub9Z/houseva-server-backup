{% extends "./layout/base-frame.html" %}
 
{% block body %}
<script type="text/javascript" src="http://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js" data-appid="101485090" data-redirecturi="http://www.xaoji.com/index.html" charset="utf-8"></script>
<div class='root-body'>
    <div class='title-bar'>
        <div class='linear-layout'>
            <span class='logo'>小鸡评房</span>
            <div class='search-bar'>
                <input class='search-input' placeholder="搜索楼盘或户型">
                <img class='icon-m search-icon' src='image/search.png'/>
            </div>
        </div>
    </div>

    <div class='middle-content' style='position:relative'>
        <div style='width:100%;margin-top:150px'>
           <form class='login-form'>
                <div class="form-group"  style='margin-bottom:30px'>
                    <input type="email" class="form-control loginId" id="exampleInputEmail1" placeholder="用户名或邮箱">
                </div>
                <div class="form-group" style='margin-bottom:30px'>
                    <input type="password" class="form-control password" id="exampleInputPassword1" placeholder="密码">
                </div>
                <a class="btn-main btn-login h-center-block-fix-width" style="margin-bottom: 20px">登录</a>
                <span id="qqLoginBtn"style="text-align: center;display:block;"></span>
                <script type="text/javascript">
                    QC.Login({
                        //btnId：插入按钮的节点id，必选
                        btnId:"qqLoginBtn",    
                        //用户需要确认的scope授权项，可选，默认all
                        scope:"all",
                        //按钮尺寸，可用值[A_XL| A_L| A_M| A_S|  B_M| B_S| C_S]，可选，默认B_S
                        size: "A_L"
                    }, function(reqData, opts){//登录成功
                        //根据返回数据，更换按钮显示状态方法
                        var dom = document.getElementById(opts['btnId']),
                        _logoutTemplate=[
                             //头像
                             '<span><img src="{figureurl}" class="{size_key}"/></span>',
                             //昵称
                             '<span>{nickname}</span>',
                             //退出
                             '<span><a href="javascript:QC.Login.signOut();">退出</a></span>'    
                        ].join("");
                        dom && (dom.innerHTML = QC.String.format(_logoutTemplate, {
                            nickname : QC.String.escHTML(reqData.nickname), //做xss过滤
                            figureurl : reqData.figureurl
                        }));
                    }, function(opts){//注销成功
                          alert('QQ登录 注销成功');
                    }
                 );
                 
                      </script>
            </form>
            <!--
            <div class='login-box h-center-with-wrap-child'>
                <a href='javascript:;'>
                    <span class='logo' id='weixin'></span><span>微信</span>
                </a>
                <a href='javascript:;'>
                    <span class='logo' id='qq'></span><span>QQ</span>
                </a>
            </div>-->
        </div>
    </div>

    <ul class='tab-launcher-bar'>
        <li><a href="/index.html">首页</a></li>
        <li><a href="/evaluate.html">申请评测</a></li>
        <li class='active'><a href="#">未登录</a></li>
    </ul>
</div>


<script>

$(function() {
    PageRenderer.initTitleBar();
});


$(function() {
    PageRenderer.initTitleBar();

    $(".btn-login").click(function(e) {
        performLogin();
    });
});


 function performLogin(){
    // 根据url中的id查询 
    var name = $(".loginId").val();
    var passwd = $(".password").val();
    if (!name) {
        toast("账号不能会空");
        return;
    }
    if (!passwd || passwd.length < 6) {
        toast("密码不能会空，且必须大于6位");
        return;
    }
    
    $.ajax({
        url: "/api/login",
        data: {loginId: name, password: passwd},
        dataType: 'json',
        success: function(response) {
            // set cookie ?
            commonHandleResponse(response, function(resp) {
                toast("登录成功");
                var token = response.data.token;
                // localStorage也存一份
                storageSet('jwtToken', token);
                // cookie中设置token
                document.cookie ="jwtToken=" + token;  
                setTimeout(function() {
                    // 注册成功，跳转到'我的页面'
                    window.location.href = "/my.html";
                }, 1000);
            });
        }, 
        error: function(response) {
            console.log(response);
        }
    });
}


</script>

{% endblock %}